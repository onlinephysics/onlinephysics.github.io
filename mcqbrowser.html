<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Physics - Fast MCQ Browser</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;500;700&family=Poppins:wght@600&display=swap');

        :root {
            --primary-bg: #f4f7fc;
            --secondary-bg: #ffffff;
            --text-color: #333;
            --heading-color: #0f2027;
            --accent-color: #3498db;
            --accent-hover: #2980b9;
            --correct-color: #2ecc71;
            --incorrect-color: #e74c3c;
            --light-gray: #e9ecef;
            --shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            --border-radius: 15px;
            --border-color: #dee2e6;
        }

        html.dark-mode {
            --primary-bg: #0f2027;
            --secondary-bg: #203a43;
            --text-color: #e0e0e0;
            --heading-color: #ffffff;
            --accent-color: #1abc9c;
            --accent-hover: #16a085;
            --light-gray: #2c5364;
            --shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            --border-color: #405a63;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Noto Sans Bengali', sans-serif;
        }

        body {
            background: var(--primary-bg);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 15px;
            transition: background 0.3s, color 0.3s;
        }

        .theme-switcher {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background-color: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: var(--secondary-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 30px;
            text-align: center;
            overflow: hidden;
            position: relative;
            border: 1px solid var(--border-color);
        }

        .screen {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1, h2 {
            font-size: 2.2em;
            margin-bottom: 20px;
            color: var(--heading-color);
        }
        
        #selection-screen h1 { font-size: 2.5em; }
        #selection-screen p { margin-bottom: 30px; }

        .selection-box {
            margin-bottom: 20px;
        }

        .selection-box label {
            display: block;
            font-size: 1.2em;
            font-weight: 500;
            margin-bottom: 10px;
            color: var(--heading-color);
        }

        select {
            width: 100%;
            padding: 15px;
            font-size: 1.1em;
            border-radius: 10px;
            border: 2px solid var(--border-color);
            background: var(--primary-bg);
            color: var(--text-color);
            cursor: pointer;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23888' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
        }

        select:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        p {
            margin-bottom: 20px;
            font-size: 1.1em;
            line-height: 1.6;
        }
        
        .buttons-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(45deg, var(--accent-color), var(--accent-hover));
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2em;
            font-weight: 700;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0, 0.15);
            display: inline-block;
        }

        .btn:hover:not([disabled]) {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(0,0,0, 0.2);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        #quiz-screen .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            font-size: 1.1em;
            font-weight: 500;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        #question-counter, #score-display {
             background: var(--light-gray);
             padding: 8px 15px;
             border-radius: 20px;
             color: var(--heading-color);
        }

        #timer {
            display: flex;
            align-items: center;
            font-size: 1.5em;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            color: var(--accent-color);
        }
        
        #progress-bar-container {
            width: 100%;
            height: 10px;
            background-color: var(--light-gray);
            border-radius: 5px;
            margin-bottom: 25px;
            overflow: hidden;
        }

        #progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-color), var(--accent-hover));
            width: 0%;
            border-radius: 5px;
            transition: width 0.5s ease-out;
        }
        
        #question-text {
            font-size: 1.4em;
            font-weight: 700;
            margin-bottom: 25px;
            min-height: 80px;
        }
        
        #options-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .option-btn {
            width: 100%;
            padding: 18px;
            font-size: 1.1em;
            font-weight: 500;
            border-radius: var(--border-radius);
            border: 2px solid var(--border-color);
            background: var(--secondary-bg);
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
        }

        .option-btn:hover:not([disabled]) {
            border-color: var(--accent-color);
            transform: scale(1.02);
        }
        
        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }

        .option-btn.correct {
            background-color: var(--correct-color);
            color: white;
            border-color: var(--correct-color);
            animation: pulse 0.5s;
        }

        .option-btn.incorrect {
            background-color: var(--incorrect-color);
            color: white;
            border-color: var(--incorrect-color);
            animation: shake 0.5s;
        }
        
        @keyframes pulse {
          0% { transform: scale(1); }
          50% { transform: scale(1.05); }
          100% { transform: scale(1); }
        }

        @keyframes shake {
          0%, 100% { transform: translateX(0); }
          25% { transform: translateX(-5px); }
          75% { transform: translateX(5px); }
        }

        #overview-screen h2 { margin-bottom: 10px; }
        #overview-summary { font-size: 1.2em; font-weight: bold; margin-bottom: 25px; background: var(--light-gray); padding: 15px; border-radius: 10px; display: flex; flex-direction: column; align-items: center; gap: 15px; color: var(--heading-color); }
        #overview-summary-stats { display: flex; justify-content: center; gap: 30px;}
        .summary-correct { color: var(--correct-color); }
        .summary-incorrect { color: var(--incorrect-color); }
        #overview-list { max-height: 40vh; overflow-y: auto; text-align: left; margin-bottom: 25px; padding-right: 10px; }
        .overview-item { background: var(--primary-bg); border: 1px solid var(--border-color); border-radius: 10px; padding: 15px; margin-bottom: 10px; position: relative; padding-right: 40px; }
        .overview-item p { margin-bottom: 8px; font-size: 1em; }
        .overview-item .question { font-weight: bold; }
        .overview-item .explanation { font-size: 0.9em; color: var(--text-color); background: var(--light-gray); padding: 8px; border-radius: 5px; margin-top: 5px; opacity: 0.9; }
        .overview-status { position: absolute; top: 50%; right: 15px; transform: translateY(-50%); font-size: 2em; }
        .status-correct { color: var(--correct-color); }
        .status-incorrect { color: var(--incorrect-color); }

        footer {
            margin-top: 25px;
            text-align: center;
            color: var(--text-color);
            opacity: 0.7;
            font-size: 1em;
        }

        footer p { margin-bottom: 5px; }

        @media (max-width: 600px) {
            .container { padding: 15px; }
            h1, h2 { font-size: 1.8em; }
            #question-text { font-size: 1.2em; min-height: 70px; }
            #options-container { grid-template-columns: 1fr; }
            .option-btn { padding: 15px; font-size: 1em; }
            #quiz-screen .header { flex-direction: column; gap: 10px; margin-bottom: 15px; }
        }
    </style>
</head>
<body>
<div class="theme-switcher" id="theme-switcher">üåô</div>

<div class="container">
    <!-- Selection Screen -->
    <div id="selection-screen" class="screen active">
        <h1>Physics MCQ Browser</h1>
        <p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡¶õ‡¶®‡ßç‡¶¶‡ßá‡¶∞ ‡¶¨‡¶á, ‡¶Ö‡¶ß‡ßç‡¶Ø‡¶æ‡ßü ‡¶è‡¶¨‡¶Ç ‡¶ü‡¶™‡¶ø‡¶ï ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßá ‡¶ï‡ßÅ‡¶á‡¶ú ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
        
        <div class="selection-box">
            <label for="book-select">‡¶¨‡¶á ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</label>
            <select id="book-select">
                <option value="">-- ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶¨‡¶á ‡¶¨‡¶æ‡¶õ‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶® --</option>
            </select>
        </div>

        <div class="selection-box">
            <label for="chapter-select">‡¶Ö‡¶ß‡ßç‡¶Ø‡¶æ‡ßü ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</label>
            <select id="chapter-select" disabled>
                <option value="">-- ‡¶¨‡¶á ‡¶¨‡¶æ‡¶õ‡¶æ‡¶á‡ßü‡ßá‡¶∞ ‡¶™‡¶∞ ‡¶Ö‡¶ß‡ßç‡¶Ø‡¶æ‡ßü ‡¶¨‡¶æ‡¶õ‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶® --</option>
            </select>
        </div>
        
        <div class="selection-box">
            <label for="topic-select">‡¶ü‡¶™‡¶ø‡¶ï ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</label>
            <select id="topic-select" disabled>
                <option value="">-- ‡¶Ö‡¶ß‡ßç‡¶Ø‡¶æ‡ßü ‡¶¨‡¶æ‡¶õ‡¶æ‡¶á‡ßü‡ßá‡¶∞ ‡¶™‡¶∞ ‡¶ü‡¶™‡¶ø‡¶ï ‡¶¨‡¶æ‡¶õ‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶® --</option>
            </select>
        </div>

        <button id="load-quiz-btn" class="btn" disabled>‡¶ï‡ßÅ‡¶á‡¶ú ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>

    <!-- Start Screen -->
    <div id="start-screen" class="screen">
        <h1 id="quiz-title"></h1>
        <p id="quiz-description"></p>
        <p><strong id="quiz-question-count"></strong></p>
        <div class="buttons-container">
            <button id="start-btn" class="btn">‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßÅ‡¶á‡¶ú ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <button id="back-to-selection-btn" class="btn">‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®</button>
        </div>
    </div>

    <!-- Quiz Screen -->
    <div id="quiz-screen" class="screen">
        <div class="header">
            <div id="question-counter"></div>
            <div id="timer"><span id="timer-text"></span></div>
            <div id="score-display">‡¶∏‡ßç‡¶ï‡ßã‡¶∞: 0</div>
        </div>
        <div id="progress-bar-container"><div id="progress-bar"></div></div>
        <div id="question-text"></div>
        <div id="options-container"></div>
    </div>
    
    <!-- Overview Screen -->
    <div id="overview-screen" class="screen">
        <h2 id="overview-title"></h2>
        <div id="overview-summary"></div>
        <div id="overview-list"></div>
        <button id="continue-btn" class="btn"></button>
    </div>
</div>

<footer>
    <p>Abu Hasan, Assistant Professor</p>
    <p>Department of Physics, Rangpur Government College, Rangpur.</p>
</footer>

<script>
    // ===================================================================================
    // === CONFIGURATION: EDIT THIS SECTION TO ADD YOUR BOOKS, CHAPTERS, and TOPICS ===
    // ===================================================================================
    const quizRepository = {
        "‡¶™‡¶¶‡¶æ‡¶∞‡ßç‡¶•‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡ßß‡¶Æ ‡¶™‡¶§‡ßç‡¶∞": {
            "‡¶≠‡ßá‡¶ï‡ßç‡¶ü‡¶∞": {
                "‡¶≠‡ßá‡¶ï‡ßç‡¶ü‡¶∞‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶ö‡¶ø‡¶§‡¶ø": "https://physicsmcq.pages.dev/ph1st/vector/introduction.json",
                "‡¶≠‡ßá‡¶ï‡ßç‡¶ü‡¶∞ ‡¶ó‡ßÅ‡¶£‡¶®": "https://physicsmcq.pages.dev/ph1st/vector/product.json",
                "‡¶≠‡ßá‡¶ï‡ßç‡¶ü‡¶∞ ‡¶Ö‡¶™‡¶æ‡¶∞‡ßá‡¶ü‡¶∞": "https://physicsmcq.pages.dev/ph1st/vector/operator.json"
            },
            "‡¶®‡¶ø‡¶â‡¶ü‡¶®‡ßÄ‡ßü ‡¶¨‡¶≤‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶æ": {
                "‡¶¨‡¶≤ ‡¶ì ‡¶®‡¶ø‡¶â‡¶ü‡¶®‡ßá‡¶∞ ‡¶ó‡¶§‡¶ø‡¶∏‡ßÇ‡¶§‡ßç‡¶∞": "https://physicsmcq.pages.dev/ph1st/nm/ForceAndNewtonsLawsOfMotion.json",
                "‡¶≠‡¶∞‡¶¨‡ßá‡¶ó": "https://physicsmcq.pages.dev/ph1st/nm/Momentum.json",
                "‡¶∏‡¶Ç‡¶ò‡¶∞‡ßç‡¶∑": "https://physicsmcq.pages.dev/ph1st/nm/Collision.json",
                "‡¶ò‡¶∞‡ßç‡¶∑‡¶£": "https://physicsmcq.pages.dev/ph1st/nm/Friction.json",
                "‡¶∞‡¶æ‡¶∏‡ßç‡¶§‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶Ç‡¶ï‡¶ø‡¶Ç": "https://physicsmcq.pages.dev/ph1st/nm/StreetBanking.json",
                "‡¶ú‡ßú‡¶§‡¶æ‡¶∞ ‡¶≠‡ßç‡¶∞‡¶æ‡¶Æ‡¶ï": "https://physicsmcq.pages.dev/ph1st/nm/MomentOfInertia.json",
                "‡¶ï‡ßå‡¶£‡¶ø‡¶ï ‡¶ó‡¶§‡¶ø‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶æ": "https://physicsmcq.pages.dev/ph1st/nm/AngularDynamics.json",
                "‡¶≤‡¶ø‡¶´‡¶ü": "https://physicsmcq.pages.dev/ph1st/nm/Lift.json",
                "‡¶∞‡¶ï‡ßá‡¶ü‡ßá‡¶∞ ‡¶ó‡¶§‡¶ø": "https://physicsmcq.pages.dev/ph1st/nm/Rocket.json"
            },
            "‡¶Ü‡¶¶‡¶∞‡ßç‡¶∂ ‡¶ó‡ßç‡¶Ø‡¶æ‡¶∏ ‡¶ì ‡¶ó‡ßç‡¶Ø‡¶æ‡¶∏‡ßá‡¶∞ ‡¶ó‡¶§‡¶ø‡¶§‡¶§‡ßç‡¶§‡ßç‡¶¨": {
                "‡¶Ü‡¶¶‡¶∞‡ßç‡¶∂ ‡¶ó‡ßç‡¶Ø‡¶æ‡¶∏ ‡¶∏‡ßÇ‡¶§‡ßç‡¶∞‡¶æ‡¶¨‡¶≤‡ßÄ": "https://physicsmcq.pages.dev/ph1st/idealgas/idealgas.json",
                "‡¶ó‡ßç‡¶Ø‡¶æ‡¶∏‡ßá‡¶∞ ‡¶ó‡¶§‡¶ø‡¶§‡¶§‡ßç‡¶§‡ßç‡¶¨": "https://physicsmcq.pages.dev/ph1st/idealgas/KineticTheory.json",
                "‡¶¨‡¶æ‡¶∏‡ßç‡¶§‡¶¨ ‡¶ó‡ßç‡¶Ø‡¶æ‡¶∏ ‡¶ì ‡¶ú‡¶≤‡ßÄ‡ßü ‡¶¨‡¶æ‡¶∑‡ßç‡¶™": "https://physicsmcq.pages.dev/ph1st/idealgas/RealGasWaterVapour.json"
            }
        },
        "‡¶™‡¶¶‡¶æ‡¶∞‡ßç‡¶•‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡ß®‡ßü ‡¶™‡¶§‡ßç‡¶∞": {
            // Add chapters for the 2nd paper here in the future
        }
    };
    // ===================================================================================
    // =================== END OF CONFIGURATION SECTION ==================================
    // ===================================================================================

    // DOM Elements
    const screens = {
        selection: document.getElementById('selection-screen'),
        start: document.getElementById('start-screen'),
        quiz: document.getElementById('quiz-screen'),
        overview: document.getElementById('overview-screen')
    };
    const bookSelect = document.getElementById('book-select');
    const chapterSelect = document.getElementById('chapter-select');
    const topicSelect = document.getElementById('topic-select');
    const loadQuizBtn = document.getElementById('load-quiz-btn');
    const startBtn = document.getElementById('start-btn');
    const backToSelectionBtn = document.getElementById('back-to-selection-btn');
    const continueBtn = document.getElementById('continue-btn');
    const themeSwitcher = document.getElementById('theme-switcher');

    // Quiz UI Elements
    const quizTitle = document.getElementById('quiz-title');
    const quizDescription = document.getElementById('quiz-description');
    const quizQuestionCount = document.getElementById('quiz-question-count');
    const questionCounter = document.getElementById('question-counter');
    const scoreDisplay = document.getElementById('score-display');
    const timerText = document.getElementById('timer-text');
    const progressBar = document.getElementById('progress-bar');
    const questionText = document.getElementById('question-text');
    const optionsContainer = document.getElementById('options-container');
    const overviewTitle = document.getElementById('overview-title');
    const overviewSummary = document.getElementById('overview-summary');
    const overviewList = document.getElementById('overview-list');

    // Quiz State
    let quizData = {};
    let currentQuestionIndex = 0;
    let score = 0;
    let timer;
    let timeLeft = 0;
    let userAnswers = [];
    let TIME_LIMIT = 37; // Default timer

    // --- Core Logic ---

    function showScreen(screenId) {
        Object.values(screens).forEach(screen => screen.classList.remove('active'));
        screens[screenId].classList.add('active');
    }

    // --- Theme Management ---
    function applyTheme(theme) {
        if (theme === 'dark') {
            document.documentElement.classList.add('dark-mode');
            themeSwitcher.textContent = '‚òÄÔ∏è';
        } else {
            document.documentElement.classList.remove('dark-mode');
            themeSwitcher.textContent = 'üåô';
        }
    }

    themeSwitcher.addEventListener('click', () => {
        const isDark = document.documentElement.classList.contains('dark-mode');
        const newTheme = isDark ? 'light' : 'dark';
        localStorage.setItem('theme', newTheme);
        applyTheme(newTheme);
    });

    // --- Selection Screen Logic ---
    function populateBooks() {
        Object.keys(quizRepository).forEach(book => {
            const option = document.createElement('option');
            option.value = book;
            option.textContent = book;
            bookSelect.appendChild(option);
        });
    }

    bookSelect.addEventListener('change', () => {
        const selectedBook = bookSelect.value;
        chapterSelect.innerHTML = '<option value="">-- ‡¶¨‡¶á ‡¶¨‡¶æ‡¶õ‡¶æ‡¶á‡ßü‡ßá‡¶∞ ‡¶™‡¶∞ ‡¶Ö‡¶ß‡ßç‡¶Ø‡¶æ‡ßü ‡¶¨‡¶æ‡¶õ‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶® --</option>';
        topicSelect.innerHTML = '<option value="">-- ‡¶Ö‡¶ß‡ßç‡¶Ø‡¶æ‡ßü ‡¶¨‡¶æ‡¶õ‡¶æ‡¶á‡ßü‡ßá‡¶∞ ‡¶™‡¶∞ ‡¶ü‡¶™‡¶ø‡¶ï ‡¶¨‡¶æ‡¶õ‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶® --</option>';
        chapterSelect.disabled = true;
        topicSelect.disabled = true;
        loadQuizBtn.disabled = true;
        if (selectedBook) {
            const chapters = quizRepository[selectedBook];
            Object.keys(chapters).forEach(chapter => {
                const option = document.createElement('option');
                option.value = chapter;
                option.textContent = chapter;
                chapterSelect.appendChild(option);
            });
            chapterSelect.disabled = false;
        }
    });

    chapterSelect.addEventListener('change', () => {
        const selectedBook = bookSelect.value;
        const selectedChapter = chapterSelect.value;
        topicSelect.innerHTML = '<option value="">-- ‡¶Ö‡¶ß‡ßç‡¶Ø‡¶æ‡ßü ‡¶¨‡¶æ‡¶õ‡¶æ‡¶á‡ßü‡ßá‡¶∞ ‡¶™‡¶∞ ‡¶ü‡¶™‡¶ø‡¶ï ‡¶¨‡¶æ‡¶õ‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶® --</option>';
        topicSelect.disabled = true;
        loadQuizBtn.disabled = true;
        if (selectedChapter) {
            const topics = quizRepository[selectedBook][selectedChapter];
            Object.keys(topics).forEach(topic => {
                const option = document.createElement('option');
                option.value = topic;
                option.textContent = topic;
                topicSelect.appendChild(option);
            });
            topicSelect.disabled = false;
        }
    });

    topicSelect.addEventListener('change', () => {
        loadQuizBtn.disabled = !topicSelect.value;
    });

    loadQuizBtn.addEventListener('click', async () => {
        const book = bookSelect.value;
        const chapter = chapterSelect.value;
        const topic = topicSelect.value;
        const url = quizRepository[book][chapter][topic];
        loadQuizBtn.textContent = '‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
        loadQuizBtn.disabled = true;
        try {
            const response = await fetch(url);
            if (!response.ok) throw new Error('Network response was not ok.');
            const data = await response.json();
            quizData = data;
            TIME_LIMIT = data["timer for each question in seconds"] || 37;
            quizTitle.textContent = quizData.title;
            quizDescription.textContent = `‡¶è‡¶á ‡¶ï‡ßÅ‡¶á‡¶ú‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¶‡¶ï‡ßç‡¶∑‡¶§‡¶æ ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡¶Æ‡ßü ‡¶™‡¶æ‡¶¨‡ßá‡¶® ${TIME_LIMIT} ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡•§`;
            quizQuestionCount.textContent = `‡¶Æ‡ßã‡¶ü ${quizData.questions.length}‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®`;
            showScreen('start');
        } catch (error) {
            console.error('Failed to load quiz:', error);
            alert('‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶ï‡ßÅ‡¶á‡¶ú‡¶ü‡¶ø ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶π‡ßü‡¶®‡¶ø‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ JSON ‡¶≤‡¶ø‡¶Ç‡¶ï‡¶ü‡¶ø ‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
        } finally {
            loadQuizBtn.textContent = '‡¶ï‡ßÅ‡¶á‡¶ú ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®';
            loadQuizBtn.disabled = !topicSelect.value;
        }
    });

    backToSelectionBtn.addEventListener('click', () => {
        showScreen('selection');
    });

    // --- Quiz Gameplay Logic ---
    startBtn.addEventListener('click', () => {
        currentQuestionIndex = 0;
        score = 0;
        userAnswers = [];
        scoreDisplay.textContent = '‡¶∏‡ßç‡¶ï‡ßã‡¶∞: 0';
        showScreen('quiz');
        loadQuestion();
    });

    function loadQuestion() {
        resetState();
        progressBar.style.width = `${((currentQuestionIndex) / quizData.questions.length) * 100}%`;
        const currentQuestionData = quizData.questions[currentQuestionIndex];
        questionCounter.textContent = `‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ${currentQuestionIndex + 1}/${quizData.questions.length}`;
        questionText.innerHTML = currentQuestionData.question;
        
        // Clear previous options
        optionsContainer.innerHTML = ''; 
        for (const key in currentQuestionData.options) {
            const button = document.createElement('button');
            button.innerHTML = `${key}. ${currentQuestionData.options[key]}`;
            button.classList.add('option-btn');
            button.dataset.key = key;
            button.addEventListener('click', () => selectAnswer(button, key));
            optionsContainer.appendChild(button);
        }
        startTimer();
    }
    
    function startTimer() {
        timeLeft = TIME_LIMIT;
        timerText.textContent = timeLeft;
        timer = setInterval(() => {
            timeLeft--;
            timerText.textContent = timeLeft;
            if (timeLeft <= 0) {
                clearInterval(timer);
                selectAnswer(null, null);
            }
        }, 1000);
    }

    function resetState() {
        clearInterval(timer);
    }

    function selectAnswer(selectedButton, selectedKey) {
        clearInterval(timer);
        const currentQuestionData = quizData.questions[currentQuestionIndex];
        const correctKey = currentQuestionData.answer;
        const isCorrect = selectedKey === correctKey;

        userAnswers.push({
            question: currentQuestionData.question,
            yourAnswer: selectedKey ? `${selectedKey}. ${currentQuestionData.options[selectedKey]}` : '‡¶∏‡¶Æ‡ßü ‡¶∂‡ßá‡¶∑',
            correctAnswer: `${correctKey}. ${currentQuestionData.options[correctKey]}`,
            explanation: currentQuestionData.explanation,
            isCorrect: isCorrect,
        });

        Array.from(optionsContainer.children).forEach(button => {
            if (button.dataset.key === correctKey) button.classList.add('correct');
            if (button === selectedButton && !isCorrect) button.classList.add('incorrect');
            button.disabled = true;
        });

        if (isCorrect) {
            score++;
            scoreDisplay.textContent = `‡¶∏‡ßç‡¶ï‡ßã‡¶∞: ${score}`;
        }
        
        setTimeout(handleNext, 1800);
    }

    // *** NEW LOGIC FOR MILESTONE AND FINAL RESULTS ***
    function handleNext() {
        currentQuestionIndex++;
        // Check if it's the end of the quiz
        if (currentQuestionIndex >= quizData.questions.length) {
            showOverview(true); // Show FINAL overview
        } 
        // Check if it's a 10-question milestone
        else if (currentQuestionIndex % 10 === 0) {
            showOverview(false); // Show MILESTONE overview
        } 
        // Otherwise, just load the next question
        else {
            loadQuestion();
        }
    }

    // *** UPDATED OVERVIEW FUNCTION TO HANDLE BOTH MILESTONE AND FINAL ***
    function showOverview(isFinal) {
        showScreen('overview');
        
        let start, end;
        let answersToShow;
        
        if (isFinal) {
            overviewTitle.textContent = '‡¶ö‡ßÇ‡ßú‡¶æ‡¶®‡ßç‡¶§ ‡¶´‡¶≤‡¶æ‡¶´‡¶≤';
            start = 0;
            end = userAnswers.length;
            answersToShow = userAnswers.slice().reverse(); // Show all answers for final report
        } else {
            // Milestone: Show summary of the last 10 questions
            end = currentQuestionIndex;
            start = end - 10;
            overviewTitle.textContent = `‡¶™‡¶∞‡ßç‡¶¨ ${end / 10} ‡¶è‡¶∞ ‡¶∏‡¶æ‡¶∞‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡ßá‡¶™`;
            answersToShow = userAnswers.slice(start, end).reverse();
        }

        overviewList.innerHTML = '';
        answersToShow.forEach((answer, index) => {
            const item = document.createElement('div');
            item.classList.add('overview-item');
            const statusIcon = answer.isCorrect ? '‚úî' : '‚úñ';
            const statusClass = answer.isCorrect ? 'status-correct' : 'status-incorrect';
            // Calculate original question number based on the slice
            const originalQuestionNumber = (isFinal ? userAnswers.length : end) - index;

            item.innerHTML = `
                <div class="overview-status ${statusClass}">${statusIcon}</div>
                <p class="question"><strong>‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ${originalQuestionNumber}:</strong> ${answer.question}</p>
                <p><strong>‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞:</strong> ${answer.yourAnswer}</p>
                ${!answer.isCorrect ? `<p><strong>‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞:</strong> ${answer.correctAnswer}</p>` : ''}
                <p class="explanation"><strong>‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ:</strong> ${answer.explanation}</p>
            `;
            overviewList.appendChild(item);
        });

        const correctCountInSegment = userAnswers.slice(start, end).filter(a => a.isCorrect).length;
        const incorrectCountInSegment = (end - start) - correctCountInSegment;

        overviewSummary.innerHTML = `
            <div id="overview-summary-stats">
                <span class="summary-correct">‚úî ‡¶∏‡¶†‡¶ø‡¶ï: ${correctCountInSegment}</span>
                <span class="summary-incorrect">‚úñ ‡¶≠‡ßÅ‡¶≤: ${incorrectCountInSegment}</span>
            </div>
        `;
        
        if (isFinal) {
            overviewSummary.innerHTML += `<div><strong>‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü ‡¶∏‡ßç‡¶ï‡ßã‡¶∞: ${score}/${quizData.questions.length}</strong></div>`;
            continueBtn.textContent = '‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßÅ‡¶á‡¶ú ‡¶¨‡¶æ‡¶õ‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶®';
        } else {
            continueBtn.textContent = '‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶™‡¶∞‡ßç‡¶¨‡ßá ‡¶Ø‡¶æ‡¶®';
        }
    }
    
    // *** UPDATED CONTINUE BUTTON LOGIC ***
    continueBtn.addEventListener('click', () => {
        // If we are at the end of the quiz, go back to the selection screen
        if (currentQuestionIndex >= quizData.questions.length) {
            showScreen('selection');
            // Reset dropdowns for a new selection
            bookSelect.value = '';
            chapterSelect.innerHTML = '<option value="">-- ‡¶¨‡¶á ‡¶¨‡¶æ‡¶õ‡¶æ‡¶á‡ßü‡ßá‡¶∞ ‡¶™‡¶∞ ‡¶Ö‡¶ß‡ßç‡¶Ø‡¶æ‡ßü ‡¶¨‡¶æ‡¶õ‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶® --</option>';
            topicSelect.innerHTML = '<option value="">-- ‡¶Ö‡¶ß‡ßç‡¶Ø‡¶æ‡ßü ‡¶¨‡¶æ‡¶õ‡¶æ‡¶á‡ßü‡ßá‡¶∞ ‡¶™‡¶∞ ‡¶ü‡¶™‡¶ø‡¶ï ‡¶¨‡¶æ‡¶õ‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶® --</option>';
            chapterSelect.disabled = true;
            topicSelect.disabled = true;
            loadQuizBtn.disabled = true;
        } 
        // Otherwise, it was a milestone, so continue to the next question
        else {
            showScreen('quiz');
            loadQuestion();
        }
    });

    // --- Initial Load ---
    window.addEventListener('load', () => {
        populateBooks();
        const savedTheme = localStorage.getItem('theme') || 'light';
        applyTheme(savedTheme);
    });

</script>
</body>
</html>